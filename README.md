# Rule621Bot

## –û–ø–∏—Å–∞–Ω–∏–µ
Telegram-–±–æ—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ—Å—Ç–∏–Ω–≥–∞ –º–µ–¥–∏–∞ –∏–∑ booru-—Å–∞–π—Ç–æ–≤ (e621, rule34) –≤ –≤–∞—à –∫–∞–Ω–∞–ª. –ë–æ—Ç –æ–±–ª–∞–¥–∞–µ—Ç –≥–∏–±–∫–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∏ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –∫–∞–Ω–∞–ª–æ–≤.

## Description
A Telegram bot for automatically posting media from booru sites (e621, rule34) to your channel. The bot has flexible settings and is intended for channel administrators.

---

## üá∑üá∫ –†—É—Å—Å–∫–∏–π

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- **–ê–≤—Ç–æ–ø–æ—Å—Ç–∏–Ω–≥:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è –º–µ–¥–∏–∞ –≤ –∑–∞–¥–∞–Ω–Ω—ã–π –∫–∞–Ω–∞–ª —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º.
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ API:** –†–∞–±–æ—Ç–∞ —Å `e621.net` –∏ `rule34.xxx`.
- **–ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:**
    - –í—ã–±–æ—Ä –∏—Å—Ç–æ—á–Ω–∏–∫–∞ API.
    - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–≥–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞ (–≤–∫–ª—é—á–∞—è –ª–æ–≥–∏–∫—É "–ò"/"–ò–õ–ò").
    - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–Ω—Ç–∏-—Ç–µ–≥–æ–≤ (–∏—Å–∫–ª—é—á–∞—é—â–∏–µ —Ç–µ–≥–∏).
    - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –ø–æ—Å—Ç–∏–Ω–≥–∞.
    - –í—ã–±–æ—Ä –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –ø–æ—Å—Ç–æ–≤ (—Å–ª—É—á–∞–π–Ω—ã–π, –Ω–æ–≤—ã–π, –ø–æ–ø—É–ª—è—Ä–Ω—ã–π –∏ —Ç.–¥.).
- **–ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∏:**
    - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —à–∞–±–ª–æ–Ω –ø–æ–¥–ø–∏—Å–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞–º–∏ `{{source}}` –∏ `{{tags}}`.
    - –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ—Å—Ç–∞ —Å —É–Ω–∏–∫–∞–ª—å–Ω–æ–π, –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–π –ø–æ–¥–ø–∏—Å—å—é.
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:**
    - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ—Å—Ç–æ–≤.
    - –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –º–µ–¥–∏–∞ (`webm` –≤ `mp4`).
    - –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –æ–± –æ—à–∏–±–∫–∞—Ö.
- **–£–¥–æ–±–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
    - –ú–µ–Ω—é –∫–æ–º–∞–Ω–¥ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ—É–Ω–∫—Ü–∏—è–º.
    - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å –∫–Ω–æ–ø–∫–∞–º–∏.

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
#### Python
–£–∫–∞–∑–∞–Ω—ã –≤ —Ñ–∞–π–ª–µ `requirements.txt`:
```
aiogram==3.4.1
aiohttp==3.9.3
aiosqlite==0.19.0
APScheduler==3.10.4
PyYAML==6.0.1
python-dotenv==1.0.1
aiofiles==23.2.1
pydantic==2.5.3
pydantic-settings==2.2.1
cachetools==5.3.3
```

#### –í–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- **FFmpeg:** –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤–∏–¥–µ–æ.
- **aria2c:** –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤.

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫
1.  **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
    ```bash
    git clone <repository_url>
    cd rule621bot
    ```
2.  **–°–æ–∑–¥–∞–π—Ç–µ –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:**
    ```bash
    python3 -m venv venv
    source venv/bin/activate
    ```
3.  **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python:**
    ```bash
    pip install -r requirements.txt
    ```
4.  **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
    *   **Debian/Ubuntu:**
        ```bash
        sudo apt update && sudo apt install ffmpeg aria2 -y
        ```
    *   **Arch Linux:**
        ```bash
        sudo pacman -S ffmpeg aria2
        ```
5.  **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
    *   –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –∏–∑ `env_example` –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ –Ω–µ–≥–æ —Ç–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ –±–æ—Ç–∞:
        ```
        BOT_TOKEN=123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11
        ```
    *   –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `config.yaml` –∏–∑ `config.yaml.exaple` –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤–∞—à Telegram User ID –≤ —Å–ø–∏—Å–æ–∫ `admin_ids`.
6.  **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:**
    ```bash
    python bot.py
    ```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- `/start` - –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –∏ –æ—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫.
- `/status` - –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.
- `/test_post` - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ—Å—Ç –≤ –∫–∞–Ω–∞–ª.
- `/postwithcaption` - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Å—Ç —Å —É–Ω–∏–∫–∞–ª—å–Ω–æ–π –ø–æ–¥–ø–∏—Å—å—é.

---

## üá¨üáß English

### Features
- **Auto-posting:** Automatically publishes media to a specified channel at a configurable interval.
- **API Support:** Works with `e621.net` and `rule34.xxx`.
- **Flexible Configuration:**
    - Choose the API source.
    - Set search tags (with "AND"/"OR" logic).
    - Set negative tags (to exclude posts).
    - Define the posting interval.
    - Select post priority (random, newest, most popular, etc.).
- **Custom Captions:**
    - Ability to set a default caption template with `{{source}}` and `{{tags}}` placeholders.
    - Send a post with a unique, one-time caption.
- **Reliability:**
    - Checks for duplicate posts to avoid reposting.
    - Resilient media downloading and conversion (`webm` to `mp4`).
    - Detailed logging and error notifications for admins.
- **Convenient Management:**
    - Command menu for quick access to features.
    - Interactive settings menu with buttons.

### Dependencies
#### Python
Listed in the `requirements.txt` file:
```
aiogram==3.4.1
aiohttp==3.9.3
aiosqlite==0.19.0
APScheduler==3.10.4
PyYAML==6.0.1
python-dotenv==1.0.1
aiofiles==23.2.1
pydantic==2.5.3
pydantic-settings==2.2.1
cachetools==5.3.3
```

#### External Dependencies
- **FFmpeg:** for video conversion.
- **aria2c:** for accelerated file downloads.

### Installation and Launch
1.  **Clone the repository:**
    ```bash
    git clone <repository_url>
    cd rule621bot
    ```
2.  **Create and activate a virtual environment:**
    ```bash
    python3 -m venv venv
    source venv/bin/activate
    ```
3.  **Install Python dependencies:**
    ```bash
    pip install -r requirements.txt
    ```
4.  **Install external dependencies:**
    *   **Debian/Ubuntu:**
        ```bash
        sudo apt update && sudo apt install ffmpeg aria2 -y
        ```
    *   **Arch Linux:**
        ```bash
        sudo pacman -S ffmpeg aria2
        ```
5.  **Configure the bot:**
    *   Create a `.env` file from `env_example` and insert your bot token:
        ```
        BOT_TOKEN=123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11
        ```
    *   Create a `config.yaml` file from `config.yaml.exaple` and add your Telegram User ID to the `admin_ids` list.
6.  **Run the bot:**
    ```bash
    python bot.py
    ```

### Usage
- `/start` - Start the bot and open the settings menu.
- `/status` - Show the current status and settings.
- `/test_post` - Send a test post to the channel.
- `/postwithcaption` - Send a post with a unique caption.
